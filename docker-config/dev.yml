version: '2'

services:
    cache:
        extends:
            file: common.yml
            service: cache
    os-api:
        extends:
            file: common.yml
            service: os-api
        volumes:
            - ../repos/tabulator-py:/repos/tabulator-py
            - ../repos/datapackage-py:/repos/datapackage-py
            - ../repos/babbage.fiscal-data-package:/repos/babbage.fiscal-data-package
            - ../repos/babbage:/repos/babbage
            - ../repos/os-api:/repos/os-api
            - ../repos/jsontableschema-py:/repos/jsontableschema-py
            - ../repos/jsontableschema-sql-py:/repos/jsontableschema-sql-py
        environment:
            - WORKDIR=/repos/os-api
            - OS_API_ENGINE=postgresql://postgres@db/postgres
            - OS_ELASTICSEARCH_ADDRESS=es
    os-packager:
        extends:
            file: common.yml
            service: os-packager
        volumes:
            - ../repos/os-packager:/repos/os-packager
        environment:
            - DEBUG=true
            - PORT=8000
            - WORKDIR=/repos/os-packager
            - OS_EXTERNAL_ADDRESS=dev.openspending.org
            - OS_PACKAGER_CONDUCTOR_HOST=http://dev.openspending.org
    os-viewer:
        extends:
            file: common.yml
            service: os-viewer
        volumes:
            - ../repos/os-viewer:/repos/os-viewer
        environment:
            - DEBUG=true
            - PORT=8000
            - WORKDIR=/repos/os-viewer
            - OS_EXTERNAL_ADDRESS=dev.openspending.org
            - OS_VIEWER_API_HOST=http://dev.openspending.org
            - OS_VIEWER_AUTH_HOST=http://dev.openspending.org
            - OS_VIEWER_SEARCH_HOST=http://dev.openspending.org
    os-conductor:
        extends:
            file: common.yml
            service: os-conductor
        volumes:
            - ../repos/os-conductor:/repos/os-conductor
        environment:
            - WORKDIR=/repos/os-conductor
            - OS_S3_HOSTNAME=fakes3
            - OS_STORAGE_BUCKET_NAME=fake-bucket
            - OS_CONDUCTOR_ENGINE=postgresql://postgres@db/postgres
            - OS_EXTERNAL_ADDRESS=dev.openspending.org
            - OS_ELASTICSEARCH_ADDRESS=es
            - OS_CONDUCTOR_SECRETS_0="eJyNldmuo0gShl+ldG7pOuxgRuqLZMcsZscg32A2sxjMvrTm3cenpkfqGfWUKq9SuYRC//9FxB8fr/nelMnnK3t+/OPbx/evxQqSYnwzPVZTuG+qEP44vLW6orBKBQy2qPtHXUrMirDAEkQALhywTuDrnivU914AhzP4sLPZhjrnCZUjkqXMtzbUgVOw3KU8B2S+cK00+boyBAtrdZwIXoy12vJwtwbrXJoFFfZ96y7SIxhHjdR0fbFv7am6Xi8v0VOPMHaKMLYmVDN0bp16nUVEyeErdrg/hWfLOx1VIEa8PUrIOV9xVk+SDA1urVuo9n5fcAMXoeLMpKfVrPeN2R4pLhMYgjRyTbjkVSUhbQem05q0aHihm55te1PFoLi1kTgrCiRs1HPyVI/RorFgtgxwFILj6dMJM3IP8nQQs8fTWkzW82VC1iYNza+usV/n4x1hnS7oQqFWgs5wRRf6OMjXACKSsXLwhl/L0lQKqkcfLqCtc8qiOjRUMaZLULdqiM"
            - OS_CONDUCTOR_SECRETS_1="fc2m5VeGAB9tb+MEcw+P/16+O3bx9F1xVN9jlmyZBNn3W2f1lMzpcIXb7bZV7QR+RfTQuPVq0m/vLhz5c0g1I0hZIIymDfCQKtmTkeyDaJMYwgH8sJQyl0jLthSBAG+Yxfr/Hz3wHmMRuSrp2ydvpMuudX5NdQLvGU/Q1ntgO+mbbiA1f4b9iEF1BYAP4/UD/D6db+ClA/w+nW/gpQP8Pp1v4KUD/D6db+ClA/w+nW/gpQ/8EJdG/F5QLQ+9SWkeXoLf8umfEY7UKp9YEIuD5eLRfnxEAq64pz00upDbGKqxdj4yUSf+Veoho2k+2OOa6kvLmRYt7agReY9Elxc3jmPeutBuJldD/l+RjT3lPcfNNnPbMVh44vSlGuXggqi/v4FPErnYZn+O3mPhIiv6rY4G3dNWkf9YVOyCkWBmA+Xs8FstrEZ+tutvA7S5/ihUrk1Mo7iDaTJbTfOWxUyZug0l8HuoqoWKfM05HjtJr7hsPF+X5fBZVs3dlpiNb0NJVW"
            - OS_CONDUCTOR_SECRETS_2="Y25hjGrbD9crsbcXfFAzFrdAr0xRYfRBk8mdZTJ/ieJdbsTGNyae1oeNHLK0DADr9Iuh2QscRwjckZCo31o02crQFLgiFAADhIFCOLMJmIW9xAmnPNtADgQZ9oS1JGLDZbdXJAT2bCBy+2Qhwp7eEe4QrXVXqmt81kD3U6isR81fOP/eiLELuTJrlAIN2JU90QlShSnmadZ49EN2r65m924+p57W++LBQ0TJ54uJWc9yecVpnknSEYoKwdzpgExgZSFWpAuKeSrv0IMff+SMInx9ax/6WlBoT4U+yFylb336mKv8cJUyZ0CdmSA3tK7R0hZhN1JzqM7cMtvb9p14Ks91yG/ti9oj6XKF6S7Z6cHCr7BI5fO2zlJME6YRmWujzTzteeYAwxdztspHx6uLBpHYNQCkd2sthBmvKqQ2yywT/Jn0Rplj6gK4+ywZ3iW7hqws3+sfWdOnqD9tWHQ5qH62vK6Jkq/KEo7sqHf5HBKqZdoZ5XvZCFhyKHdcJHTs3S"
            - OS_CONDUCTOR_SECRETS_3="KySrdeGBxMdjhyQ9Pg7QMyUYRJh93mb630uhuVhQzBIfh7RM+EdtilReDScRdzboKyiUkOL0gExQYzbWR01bhO5NQIHr6BNca3kqdKArVbmhSHhWg3pwa9r9OX1iwIlBiPoO5dL1Vy5ok4DbYAXx2PRjtHMYDj+HB7a9umK2ebF0U/w9pwDfv7o6sN11P86zGvzXNANAWP2fbc+YLBvrEv9MqCj1KfFhaw+Ls/9A5GJFuGUaG412c7nRQbkl1BFTAafWijMQI/7SjgOny2w92l5pRQio5nl1hGXI+n6K1k/dI5S2ULi8sjmhzQBpaP1+NOn8IiZ6bLgYae2K/wFjJVPucBwcGkU/hYj00wiLo3UVq57aZ5co5zImNIqaYJUzv0mpUWQJrUxZxwoXyXVvrCwku4D9PLMy6KipViZVZY+N2rrehyZtvY0f2zmMPRBYXRspF8KY8i3NUvAHXPTeJG5ViT1GS797pcNMb6/fe/DNC/G0Qf//wX2M/+cA=="
    frontend:
        extends:
            file: common.yml
            service: frontend
        volumes:
            - "./frontend/dev-nginx.conf:/etc/nginx/conf.d/dev.conf"
        ports:
            - "8080:8080"
    landing:
      extends:
          file: common.yml
          service: landing
    os-explorer:
      extends:
          file: common.yml
          service: os-explorer
      environment:
            - WORKDIR=/repos/os-explorer
      volumes:
            - ../repos/os-explorer:/repos/os-explorer
    redash:
      extends:
          file: common.yml
          service: redash
      environment:
          REDASH_DATABASE_URL: "postgresql://postgres@db/postgres"
          REDASH_SERVER_NAME: "rd.dev.openspending.org"
          OS_DB_HOST: "db"
          OS_DB_NAME: "postgres"
          OS_DB_PWD: "null"
          OS_DB_USER: "postgres"
    mq:
        extends:
            file: common.yml
            service: mq
    redis:
        extends:
            file: common.yml
            service: redis
    fakes3:
        image: openspending/fakes3
        container_name: "fakes3"
        expose:
          - "80"
    db:
        image: openspending/db
        container_name: "db"
        expose:
          - "5432"
        ports:
          - "15432:5432"
    es:
        image: openspending/es
        container_name: "es"
        expose:
          - "9200"
          - "9300"
        ports:
          - "9200:9200"
